r#!/bin/bash
# üì± TESTES DE REFATORA√á√ÉO DE AUTENTICA√á√ÉO - APK ANDROID

echo "üß™ TESTE DE REFATORA√á√ÉO DE AUTENTICA√á√ÉO - APK ANDROID"
echo "====================================================="
echo ""

echo "1Ô∏è‚É£ Build para Android..."
echo "   npm run build"
echo "   cd android && ./gradlew assembleDebug"
echo ""

echo "2Ô∏è‚É£ Instalar APK no dispositivo..."
echo "   adb install -r android/app/build/outputs/apk/debug/app-debug.apk"
echo ""

echo "3Ô∏è‚É£ TESTES NO APK (Sem fazer Login)"
echo "   ================================"
echo ""
echo "   ‚úÖ TESTE 1: Abrir APK"
echo "      - Esperado: Tela de login (signin)"
echo "      - N√£o deve redirecionar de volta"
echo ""
echo "   ‚úÖ TESTE 2: Acessar Dashboard diretamente via URL"
echo "      - Abra DevTools (F12) ‚Üí Console"
echo "      - window.location.href = 'https://localhost/dashboard'"
echo "      - Esperado: Dashboard carrega MESMO SEM LOGIN"
echo "      - N√£o deve redirecionar para signin"
echo ""
echo "   ‚úÖ TESTE 3: Acessar Pricing via URL"
echo "      - Abra DevTools ‚Üí Console"
echo "      - window.location.href = 'https://localhost/pricing'"
echo "      - Esperado: P√°gina de planos carrega"
echo "      - N√£o deve redirecionar para signin"
echo ""
echo "   ‚úÖ TESTE 4: Tentar clicar em 'Come√ßar Agora' sem login"
echo "      - Esperado: Mostra erro 'Voc√™ precisa fazer login'"
echo "      - Redireciona para signin"
echo ""

echo "4Ô∏è‚É£ TESTES NO APK (Depois de fazer Login)"
echo "   ===================================="
echo ""
echo "   ‚úÖ TESTE 5: Login normal"
echo "      - Preencha email e senha"
echo "      - Clique em 'Entrar'"
echo "      - Esperado: Redireciona para /dashboard"
echo ""
echo "   ‚úÖ TESTE 6: Navegar para Pricing"
echo "      - Na tela do Dashboard, clique em 'Planos' (ou menu)"
echo "      - Esperado: Pricing page carrega com bot√£o 'Come√ßar Agora' ativo"
echo ""
echo "   ‚úÖ TESTE 7: Clicar em 'Come√ßar Agora'"
echo "      - Clique no bot√£o de checkout"
echo "      - Esperado: Redireciona para Stripe (ou sandbox)"
echo "      - N√ÉO deve redirecionar para signin"
echo ""
echo "   ‚úÖ TESTE 8: An√°lise IA"
echo "      - Na tela do Dashboard, clique em 'Enviar Extrato'"
echo "      - Selecione um arquivo CSV/OFX"
echo "      - Clique em 'Analisar'"
echo "      - Esperado: IA analisa o arquivo"
echo "      - Se atingiu limite: mostra mensagem de limite"
echo ""
echo "   ‚úÖ TESTE 9: Settings/Configura√ß√µes"
echo "      - Clique no menu ‚Üí Settings"
echo "      - Esperado: P√°gina carrega normalmente"
echo "      - Pode sair e voltar sem redirecionar"
echo ""

echo "5Ô∏è‚É£ TESTE CR√çTICO: Navega√ß√£o Fluida"
echo "   ================================"
echo ""
echo "   ‚úÖ Login ‚Üí Dashboard ‚Üí Pricing ‚Üí Logout ‚Üí Dashboard"
echo "      - Fazer Login"
echo "      - Ir para Pricing"
echo "      - Voltar para Dashboard"
echo "      - Fazer Logout"
echo "      - Ir para Dashboard (sem login)"
echo "      - Esperado: Sem redirecionamentos em cascata"
echo "      - Esperado: Sem loops infinitos"
echo "      - Esperado: Navega√ß√£o fluida"
echo ""

echo "6Ô∏è‚É£ VERIFICAR LOGS NO CHROME DevTools"
echo "   =================================="
echo ""
echo "   - F12 ‚Üí Console"
echo "   - Procure por erros de tipo:"
echo "     ‚ùå 'useAuthSession' not found"
echo "     ‚ùå 'persistSession' not found"
echo "   - Se ver esses erros, refatora√ß√£o FALHOU"
echo ""
echo "   - Procure por avisos normais:"
echo "     ‚ö†Ô∏è 'getCurrentUser: Checking for user...'"
echo "     ‚ö†Ô∏è 'Session restored'"
echo "   - Esses s√£o ESPERADOS"
echo ""

echo "7Ô∏è‚É£ RESULTADO ESPERADO"
echo "   =================="
echo ""
echo "   ‚úÖ Sem redirecionamentos autom√°ticos em cascata"
echo "   ‚úÖ Dashboard acess√≠vel sem login"
echo "   ‚úÖ Pricing acess√≠vel sem login"
echo "   ‚úÖ Checkout verifica login no clique"
echo "   ‚úÖ An√°lise IA verifica login no clique"
echo "   ‚úÖ Settings carrega sem login"
echo "   ‚úÖ Navega√ß√£o fluida entre telas"
echo "   ‚úÖ Sem erros de 'useAuthSession' ou 'persistSession'"
echo ""

echo "‚ùå SE ISSO N√ÉO ACONTECER"
echo "   ====================="
echo ""
echo "   - Limpe o cache do APK:"
echo "     adb shell pm clear com.fincontrol.app"
echo ""
echo "   - Reinstale o APK:"
echo "     adb install -r android/app/build/outputs/apk/debug/app-debug.apk"
echo ""
echo "   - Verifique os logs:"
echo "     adb logcat | grep -i 'fincontrol\\|capacitor\\|error'"
echo ""

echo "‚úÖ REFATORA√á√ÉO COMPLETA!"
echo "   A navega√ß√£o agora deve funcionar perfeitamente no APK Android"
